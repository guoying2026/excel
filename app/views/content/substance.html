<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Simple MVC</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="{{ASSET_ROOT}}/layui/css/layui.css">
        <style>
            .sometr{
              background-color:#EAEAEA;
              color:#3D3D3D;
              text-align: right  
            }
            .wingdings{
                font-family: 'Wingdings';
                font-size: 16px;
                font-weight: bold;
            }
        </style>
    </head>
    <body class="layui-main">
        <form class="layui-form">
        <!-- 注意getenv()在IIS下获取不到正确ip地址，它适用于apache,$_SERVER都可以 -->
            <blockquote class="layui-elem-quote" style="margin-top:30px">
                <div class="layui-form-item">
                    <div id="cat_ids1">         
                    </div>
                </div> 
            </blockquote> 
        </form>
        <div id="main" style="width:500px;height:10px"></div>
            <table class="layui-table">
              <!-- <colgroup>
                <col width="200">
                <col width="200">
                <col>
              </colgroup> -->
              <thead>
                <tr style="background-color:#B0E2FF;color:#3D3D3D"">
                  <th>LCCHN Q4/FY17</th>
                  <th>Ref.#</th>
                  <th>Risk-Description(incl.Cause and Effect)-Detailed Measures-Description</th>
                  {% for department in filesub %}
                  <th class="de_{{department.org_unit}}">{{department.org_unit}}</th>
                  {% endfor %}
                  <th>LCCHN (proposal) {{condition.version}}</th>
                </tr> 
              </thead>
              <tbody>
                  <tr style="background-color:#303030;color:#fff"><td colspan="{{ countdeparentment }}">No placerat apeirian intellegam mei</span></td></tr>
                  <tr class="sometr">
                    <td colspan="3">Trend compared to prior quater:</td>
                    {% for department in filesub %}
                    <td class="wingdings td_{{department.org_unit}}"  style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AF' and department.org_unit in info.ref_number %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                    <td class="wingdings" style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AF' and info.org_unit == 'CHN' %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                  </tr>
                  <tr class="sometr">
                    <td colspan="3">Degree of response plan completion:</td>
                    {% for department in filesub %}
                    <td class="td_{{department.org_unit}}"  style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AE' and department.org_unit in info.ref_number %}
                                {{info.value}}%
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                    <td style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AE' and info.org_unit == 'CHN' %}
                                {{info.value}}%
                            {% endif %}
                        {% endfor %}
                    </td>
                  </tr>
                  <tr class="sometr">
                    <td colspan="3">Response strategy:</td>
                    {% for department in filesub %}
                    <td class="td_{{department.org_unit}}"  style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AA' and department.org_unit in info.ref_number %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                    <td style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AA' and info.org_unit == 'CHN' %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                  </tr>
                  <tr class="sometr">
                    <td colspan="3">Expected mitigation date:</td>
                    {% for department in filesub %}
                    <td class="td_{{department.org_unit}}"  style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AC' and department.org_unit in info.ref_number %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                    <td style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AC' and info.org_unit == 'CHN' %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                  </tr>
                  <tr class="sometr">
                    <td colspan="3">Target exposure level:</td>
                    {% for department in filesub %}
                    <td class="td_{{department.org_unit}}" style="text-align: center;">
                        {% for info in entrysub %}
                            {% if info.column == 'AB' and department.org_unit in info.ref_number %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                    <td style="text-align: center">
                        {% for info in entrysub %}
                            {% if info.column == 'AB' and info.org_unit == 'CHN' %}
                                {{info.value}}
                            {% endif %}
                        {% endfor %}
                    </td>
                  </tr>
                  <tr>
                    <td>CHN</td><td>CHN</td>
                    <td colspan="{{ countdeparentment-2 }}"></td>
                  </tr>
              </tbody>
            </table>
            <div class="layui-tab layui-tab-card">
              <ul class="layui-tab-title">
               <li class="layui-this">All</li>
                {% for department in filesub %}
                    <li>{{department.org_unit}}</li>
                {% endfor %}
              </ul>
              <div class="layui-tab-content" style="height: auto">
                <div class="layui-tab-item layui-show">
                    <table class="layui-table">
                        <tbody>
                            {% for department in filesub %}
                            <tr>
                                <td rowspan="2">{{department.org_unit}}</td>
                                <td>Description</td>
                                <td>
                                    {% set i = 0 %}
                                    {% for info in all %}
                                        {% if info.column == 'D' and department.org_unit in info.org_unit and i == 0 %}
                                        {{info.value}}
                                        {% set i=i+1 %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                            </tr>
                            <tr>
                                <td>Response Plan</td>
                                <td>
                                    {% set j = 0 %}
                                    {% for info in all %}
                                        {% if info.column == 'AE' and department.org_unit in info.org_unit and j == 0 %}
                                        {{info.value}}
                                        {% set j=j+1 %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="layui-tab-item">2</div>
                <div class="layui-tab-item">3</div>
                <div class="layui-tab-item">4</div>
                <div class="layui-tab-item">5</div>
                <div class="layui-tab-item">6</div>
              </div>
            </div>
    </body>
    <script src="{{ASSET_ROOT}}/js/jquery-3.1.1.min.js"></script>
    <script src="{{ASSET_ROOT}}/layui/layui.js"></script>
    <script src="{{ASSET_ROOT}}/js/echarts.js"></script>
    <script type="text/javascript">
        //前端模板使用github上的twigphp/Twig,前端框架使用layui
        //从控制器方法中得到的数据转化成Js可以使用的数据
        let catData = "{{all |escape('js')}}";
        catDatas = JSON.parse(catData);
        console.log(catDatas);
        layui.use('element', function(){
            var element = layui.element;
  
            //获取hash来切换选项卡，假设当前地址的hash为lay-id对应的值
            var layid = location.hash.replace(/^#test1=/, '');
            element.tabChange('test1', layid); //假设当前地址为：http://a.com#test1=222，那么选项卡会自动切换到“发送消息”这一项
  
            //监听Tab切换，以改变地址hash值
            element.on('tab(test1)', function(){
                location.hash = 'test1='+ this.getAttribute('lay-id');
            });
        });
    </script>
</html>